<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <!-- build:css(.tmp) styles/main.css -->
    <link rel="stylesheet" href="styles/main.css">
    <!-- endbuild -->
  </head>
  <body ng-app="app" ng-controller="XyzeController">
    <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <!--[if lt IE 9]>
      <script src="bower_components/es5-shim/es5-shim.js"></script>
      <script src="bower_components/json3/lib/json3.min.js"></script>
    <![endif]-->

    <!-- Add your site or application content here -->
    <h1>Login Directive</h1>

    <p>Size</p>
    <div class="input-box">
      <select name="options[2]" id="select_2" class="required-entry product-custom-option">
        <option value="">-- Please Select --</option>
        <option value="1" price="0">S </option>
        <option value="2" price="0">M </option>
        <option value="3" price="0">L </option>
        <option value="4" price="0">XL </option>
    </select>
    </div>

    <p>Find your right size</p>
    <login ng-cloak
      site="http://xyze-oauth.herokuapp.com/"
      client="2b287e6d072698a0606ac2ca7e756ee3d3bcdda05c21d07eb7eb68072c2ede93"
      redirect="http://localhost:9000/magento-dev.html"
      scope="user"
      storage="cookies"
      template="views/templates/xyze/default.html">Use XYZE</login>

    <div ng-cloak ng-show="size">
      <div>Your size is {{size}}</div>
      <div>Automatically selected {{size}}</div>
    </div>

    <!--<div ng-click="changeTemplate()" class="stylize">Change View<div>-->

    <script src="bower_components/jquery/jquery.js"></script>
    <script src="bower_components/angular/angular.js"></script>

    <!-- build:js scripts/plugins.js -->
    <script src="bower_components/bootstrap-sass/js/bootstrap-affix.js"></script>
    <script src="bower_components/bootstrap-sass/js/bootstrap-alert.js"></script>
    <script src="bower_components/bootstrap-sass/js/bootstrap-dropdown.js"></script>
    <script src="bower_components/bootstrap-sass/js/bootstrap-tooltip.js"></script>
    <script src="bower_components/bootstrap-sass/js/bootstrap-modal.js"></script>
    <script src="bower_components/bootstrap-sass/js/bootstrap-transition.js"></script>
    <script src="bower_components/bootstrap-sass/js/bootstrap-button.js"></script>
    <script src="bower_components/bootstrap-sass/js/bootstrap-popover.js"></script>
    <script src="bower_components/bootstrap-sass/js/bootstrap-typeahead.js"></script>
    <script src="bower_components/bootstrap-sass/js/bootstrap-carousel.js"></script>
    <script src="bower_components/bootstrap-sass/js/bootstrap-scrollspy.js"></script>
    <script src="bower_components/bootstrap-sass/js/bootstrap-collapse.js"></script>
    <script src="bower_components/bootstrap-sass/js/bootstrap-tab.js"></script>
    <!-- endbuild -->

    <!-- build:js scripts/modules.js -->
    <script src="bower_components/angular-resource/angular-resource.js"></script>
    <script src="bower_components/angular-cookies/angular-cookies.js"></script>
    <script src="bower_components/angular-sanitize/angular-sanitize.js"></script>
    <!-- endbuild -->

    <!-- build:js({.tmp,app}) scripts/scripts.js -->
    <script src="scripts/app.js"></script>
    <script src="scripts/directives/login.js"></script>
    <script src="scripts/services/access-token.js"></script>
    <script src="scripts/services/endpoint.js"></script>
    <script src="scripts/services/request-wrapper.js"></script>
    <script src="scripts/services/profile.js"></script>
    <script src="scripts/services/client/algorithm.js"></script>
    <script src="scripts/config/config.js"></script>
    <!-- endbuild -->

    <script src="bower_components/angular-mocks/angular-mocks.js"></script>

    <script>
      angular.module('app', ['login']);
      angular.module('app').value('login.config', { profile: 'http://xyze-oauth.herokuapp.com/me' });
    </script>

    <!--<script>-->
      <!--var mock_algorithm = { result: { key: 'L' } };-->
      <!--angular.module('app', ['login', 'ngMockE2E']);-->
      <!--angular.module('app').value('login.config', { profile: 'http://xyze-oauth.herokuapp.com/me' });-->

      <!--angular.module('app').run(function($httpBackend) {-->
        <!--$httpBackend.when('GET', /http:\/\/algm.xyze.it\/platform.asmx\/search/).respond(mock_algorithm);-->
        <!--$httpBackend.when('GET', /templates/).passThrough();-->
        <!--$httpBackend.when('GET', 'http://xyze-oauth.herokuapp.com/me').passThrough();-->
      <!--});-->
    <!--</script>-->

    <script>
      function XyzeController($scope, $rootScope, Algorithm) {
        $scope.$on('login:success', function(event, token) {
          $scope.response = Algorithm.get({ brand: '123', store: '456', collection: '780', item:'ABC', access_token: token.access_token }, function() {
            $scope.size = $scope.response.result.key;
            var mapping = { S: '1', M: '2', L: '3', XL: '4' };
            $('#select_2').val(mapping[$scope.size]);
          });
        });

        $scope.$on('login:logout', function(event, token) {
          $scope.size = null;
          $("#select_2").val($("#select_2 option:first").val());
        });

        $scope.changeTemplate = function() {
          $rootScope.$broadcast('login:template', 'views/templates/default.html');
        }
      }
    </script>

    <style>
      .oauth-login img {
        width: 48px;
        height: 48px;
        margin-right: 5px;
      }

      .stylize {
        cursor: pointer;
        padding: 5px;
        margin-top: 20px;
        width: 85px;
        background:rgb(147, 203, 255);
      }
    </style>

</body>
</html>
