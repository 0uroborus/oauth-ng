/* oauth-ng - v0.2.1 - 2014-07-10 */
"use strict";var app=angular.module("oauth",["oauth.directive","oauth.accessToken","oauth.endpoint","oauth.profile","oauth.interceptor"]);angular.module("oauth").config(["$locationProvider","$httpProvider",function(a,b){a.html5Mode(!0).hashPrefix("!"),b.interceptors.push("ExpiredInterceptor")}]);var directives=angular.module("oauth.directive",[]);directives.directive("oauth",["AccessToken","Endpoint","Profile","$location","$rootScope","$compile","$http","$templateCache",function(a,b,c,d,e,f,g,h){var i={restrict:"AE",replace:!0,scope:{site:"@",clientId:"@",redirectUri:"@",scope:"@",profileUri:"@",template:"@",text:"@",authorizePath:"@",state:"@"}};return i.link=function(d,i){d.show="none",d.$watch("clientId",function(){j(),k(),b.set(d),a.set(d),l(d),m()});var j=function(){d.authorizePath=d.authorizePath||"/oauth/authorize",d.tokenPath=d.tokenPath||"/oauth/token",d.template=d.template||"bower_components/oauth-ng/dist/views/templates/default.html",d.text=d.text||"Sign In",d.state=d.state||void 0,d.scope=d.scope||void 0},k=function(){g.get(d.template,{cache:h}).success(function(a){i.html(a),f(i.contents())(d)})},l=function(b){var d=a.get();d&&d.access_token&&b.profileUri&&c.find(b.profileUri).success(function(a){b.profile=a})},m=function(){var b=a.get();return b?b.access_token?n():b.error?p():void 0:o()};d.login=function(){b.redirect()},d.logout=function(){a.destroy(d),o()};var n=function(){e.$broadcast("oauth:login",a.get()),d.show="logged-in"},o=function(){e.$broadcast("oauth:logout"),d.show="logged-out"},p=function(){d.show="denied",e.$broadcast("oauth:denied")};d.$on("oauth:template:update",function(a,b){d.template=b,k(d)})},i}]);var interceptorService=angular.module("oauth.interceptor",[]);interceptorService.factory("ExpiredInterceptor",["$rootScope","$q","$sessionStorage",function(a,b,c){var d={};d.request=function(b){var d=c.token;return d&&e(d)&&a.$broadcast("oauth:expired",d),b};var e=function(a){return a&&a.expires_at&&new Date(a.expires_at)<new Date};return d}]);var accessTokenService=angular.module("oauth.accessToken",["ngStorage"]);accessTokenService.factory("AccessToken",["$rootScope","$location","$http","$sessionStorage",function(a,b,c,d){var e={},f=null;e.get=function(){return f},e.set=function(){return g(),i(),f},e.destroy=function(){return delete d.token,f=null},e.expired=function(){return f&&f.expires_at&&f.expires_at<new Date};var g=function(){var a=h(b.hash());a&&(l(),e.setToken(a))},h=function(a){for(var b=a.split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),f=e[0],g=e[1];c[f]=g}return c.access_token||c.error?c:void 0},i=function(){if(d.token){var a=d.token;e.setToken(a)}},j=function(){d.token=f};e.setToken=function(a){return f=f||{},angular.extend(f,a),k(),j(),f};var k=function(){if(f){var a=new Date;a.setSeconds(a.getSeconds()+parseInt(f.expires_in)-60),f.expires_at=a}},l=function(){b.hash("")};return e}]);var endpointClient=angular.module("oauth.endpoint",[]);endpointClient.factory("Endpoint",["AccessToken","$location",function(){var a,b={};return b.set=function(b){var c=b.scope?encodeURIComponent(b.scope):"",d=b.state?encodeURIComponent(b.state):"";return a=b.site+b.authorizePath+"?response_type=token&client_id="+encodeURIComponent(b.clientId)+"&redirect_uri="+encodeURIComponent(b.redirectUri)+"&scope="+c+"&state="+d},b.get=function(){return a},b.redirect=function(){window.location.replace(a)},b}]);var profileClient=angular.module("oauth.profile",[]);profileClient.factory("Profile",["$http","AccessToken",function(a,b){var c,d={};d.find=function(b){var d=a.get(b,{headers:e()});return d.success(function(a){c=a}),d},d.get=function(){return c},d.set=function(a){return c=a};var e=function(){return{Authorization:"Bearer "+b.get().access_token}};return d}]);